# Configuration Files Guide

This document explains the configuration files in this project and what should be tracked in git.

## Summary

| File | In Git? | Purpose |
|------|---------|---------|
| `sdkconfig.defaults` | ✅ YES | Template's default configuration |
| `sdkconfig` | ❌ NO | User-specific generated config |
| `sdkconfig.old` | ❌ NO | Backup of previous config |
| `dependencies.lock` | ❌ NO | Auto-generated dependency lock |
| `managed_components/` | ❌ NO | Downloaded component source code |

---

## `sdkconfig.defaults` ✅ (Tracked in Git)

**Purpose**: Defines the minimal, portable default configuration for the project.

**Contains**:
- Target chip selection (ESP32)
- Flash size and mode
- Partition table selection
- Key compiler options
- Important component settings

**Why in git?**
- Ensures all users start with the same baseline configuration
- Documents the intended project settings
- Makes the project immediately buildable after cloning
- Platform-independent (works on Linux and Windows)

**When it's used**:
- On first build when `sdkconfig` doesn't exist
- When you run `idf.py reconfigure`
- Can be overridden by running `idf.py menuconfig`

---

## `sdkconfig` ❌ (NOT in Git)

**Purpose**: The active, full configuration with all options resolved.

**Contains**:
- All ESP-IDF configuration options (70KB+)
- Auto-generated values
- User customizations from `menuconfig`
- Platform-specific absolute paths (sometimes)

**Why NOT in git?**
- Auto-generated from `sdkconfig.defaults` + ESP-IDF defaults
- Very large (70KB+) with 99% being defaults
- Can contain platform-specific paths
- May vary between ESP-IDF versions
- Users may want different settings for their hardware

**What happens without it?**
- First build automatically generates it from `sdkconfig.defaults`
- No manual intervention needed

---

## `dependencies.lock` ❌ (NOT in Git)

**Purpose**: Lock file for component dependencies (similar to package-lock.json).

**Contains**:
- Exact versions of downloaded components
- Component hashes and checksums
- Platform-specific paths
- Download sources

**Why NOT in git?**
- Auto-generated by ESP Component Manager
- Platform-specific paths
- Regenerated on first build
- Components are defined in `main/idf_component.yml` (which IS in git)

**What happens without it?**
- Component manager generates it on first build
- Uses versions specified in `idf_component.yml`
- Downloads components to `managed_components/`

---

## `managed_components/` ❌ (NOT in Git)

**Purpose**: Downloaded source code of external components.

**Contains**:
- LVGL library source
- ESP LCD drivers
- Button and knob components
- Other dependencies

**Why NOT in git?**
- Downloaded automatically from component registry
- Large (megabytes of source code)
- Versions controlled by `idf_component.yml`
- Would bloat repository size

**What happens without it?**
- First build downloads all components automatically
- No manual downloads needed

---

## Best Practices

### For Template Projects (like this)

✅ **DO** commit:
- `sdkconfig.defaults` - Baseline configuration
- `main/idf_component.yml` - Component dependencies
- `.vscode/` - IDE configuration for cross-platform support

❌ **DON'T** commit:
- `sdkconfig` - User-specific configuration
- `dependencies.lock` - Auto-generated lock file
- `managed_components/` - Downloaded component sources
- `build/` - Build artifacts

### For Production Projects

You might want to commit `dependencies.lock` if you need:
- Reproducible builds with exact component versions
- Protection against upstream component changes
- CI/CD with deterministic dependency resolution

Even then, `sdkconfig` is usually still excluded.

---

## Common Workflows

### Cloning the Project

```bash
git clone <repo-url>
cd esp32s3-lvgl-template
idf.py build  # Automatically generates sdkconfig and downloads components
```

### Customizing Configuration

```bash
idf.py menuconfig  # Opens configuration menu
# Make your changes
# Save and exit
idf.py build       # Rebuilds with new config
```

Your changes are saved in `sdkconfig` (local to your machine, not in git).

### Updating Default Configuration

If you want to change the baseline for all users:

```bash
idf.py menuconfig
# Make changes
idf.py save-defconfig  # Updates sdkconfig.defaults with only changed values
git add sdkconfig.defaults
git commit -m "Update default configuration"
```

### Resetting to Defaults

```bash
rm sdkconfig          # Delete user config
idf.py reconfigure    # Regenerate from sdkconfig.defaults
idf.py build
```

---

## Cross-Platform Considerations

### `sdkconfig.defaults` ✅
- Platform-independent
- Uses relative paths and variables
- Works on Linux, Windows, and macOS

### `sdkconfig` ⚠️
- May contain absolute paths to tools
- Can differ between ESP-IDF versions
- Should regenerate when switching platforms

### Best Practice
When switching between Linux and Windows:
```bash
rm sdkconfig build/ -rf  # Clean everything
idf.py build            # Rebuild from scratch
```

---

## Troubleshooting

### "sdkconfig doesn't match"

```bash
idf.py reconfigure
idf.py build
```

### "Component versions don't match"

```bash
rm -rf managed_components dependencies.lock
idf.py reconfigure
idf.py build
```

### "Want to share my custom settings"

Don't commit `sdkconfig`. Instead:
1. Document your changes in README
2. Or update `sdkconfig.defaults`
3. Or create a separate `sdkconfig.yourname` and share it

---

## References

- [ESP-IDF Build System](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/build-system.html)
- [Project Configuration](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/kconfig.html)
- [Component Manager](https://docs.espressif.com/projects/idf-component-manager/en/latest/)
